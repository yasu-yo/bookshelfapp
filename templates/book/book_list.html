{% extends "base.html" %}

{% block title %}æ›¸ç±ä¸€è¦§{% endblock %}
{% block h1 %}æ›¸ç±ä¸€è¦§{% endblock %}

{% block content %}

<!-- ğŸ” æ¤œç´¢ãƒ»ã‚«ãƒ†ã‚´ãƒªçµã‚Šè¾¼ã¿ãƒ•ã‚©ãƒ¼ãƒ  -->
<form method="get" action="{% url 'book:list-book' %}" class="mb-4 d-flex gap-2">
  <input type="text" name="keyword" class="form-control w-25" placeholder="ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰æ¤œç´¢" value="{{ keyword }}">
  <select name="category" class="form-select w-25">
    <option value="">ã™ã¹ã¦ã®ã‚«ãƒ†ã‚´ãƒª</option>
    {% for value, label in categories %}
      <option value="{{ value }}" {% if selected_category == value %}selected{% endif %}>{{ label }}</option>
    {% endfor %}
  </select>
  <button type="submit" class="btn btn-outline-success">æ¤œç´¢</button>
</form>

<div class="row">
  <!-- ğŸ“š ç™»éŒ²é †ãƒªã‚¹ãƒˆ -->
  <div class="col-md-9">
    {% for item in Shelf %}
      <div class="p-4 m-4 bg-light border border-success rounded">
        <h2 class="text-success">{{ item.title }}</h2>
        {% if item.thumbnail %}
          <div class="w-25 p-3">
            <img src="{{ item.thumbnail.url }}" class="img-thumbnail">
          </div>
        {% else %}
          <p>No thumbnail available</p>
        {% endif %}
        <h6 class="fw-light">ã‚«ãƒ†ã‚´ãƒªï¼š{{ item.category }}</h6>
        <div class="mt-3">
          <a href="{% url 'book:detail-book' item.pk %}" class="link-secondary link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover">è©³ç´°ã¸</a>
        </div>
      </div>
    {% empty %}
      <p>è©²å½“ã™ã‚‹æ›¸ç±ã¯è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚</p>
    {% endfor %}

    <!-- ğŸ” ãƒšãƒ¼ã‚¸ãƒãƒ¼ã‚·ãƒ§ãƒ³ -->
    <div class="mt-4 d-flex justify-content-center">
      <nav aria-label="Page navigation">
        <ul class="pagination">
          {% if page_obj.has_previous %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if keyword %}&keyword={{ keyword }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}">å‰ã¸</a>
            </li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">å‰ã¸</span></li>
          {% endif %}

          {% for num in page_obj.paginator.page_range %}
            {% if page_obj.number == num %}
              <li class="page-item active"><span class="page-link">{{ num }}</span></li>
            {% else %}
              <li class="page-item">
                <a class="page-link" href="?page={{ num }}{% if keyword %}&keyword={{ keyword }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}">{{ num }}</a>
              </li>
            {% endif %}
          {% endfor %}

          {% if page_obj.has_next %}
            <li class="page-item">
              <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if keyword %}&keyword={{ keyword }}{% endif %}{% if selected_category %}&category={{ selected_category }}{% endif %}">æ¬¡ã¸</a>
            </li>
          {% else %}
            <li class="page-item disabled"><span class="page-link">æ¬¡ã¸</span></li>
          {% endif %}
        </ul>
      </nav>
    </div>
  </div>

  <!-- ğŸŒŸ ãƒ¬ãƒ“ãƒ¥ãƒ¼é †ãƒ©ãƒ³ã‚­ãƒ³ã‚° -->
  <div class="col-md-3">
    <h2>ãƒ¬ãƒ“ãƒ¥ãƒ¼å¥½è©•ã€€TOP3</h2>
    {% for ranking_book in ranking_list %}
      <div class="p-4 m-4 bg-light border border-success rounded">
        <h3 class="text-success h5">{{ ranking_book.title }}</h3>
        <div class="w-80 p-3">
          {% if ranking_book.thumbnail %}
            <img src="{{ ranking_book.thumbnail.url }}" class="img-thumbnail">
          {% else %}
            <p>No thumbnail</p>
          {% endif %}
        </div>
        <h6>è©•ä¾¡ï¼š{{ ranking_book.avg_rating|floatformat:2 }}ç‚¹</h6>
        <a href="{% url 'book:detail-book' ranking_book.id %}" class="link-secondary link-offset-2 link-underline-opacity-25 link-underline-opacity-100-hover">è©³ç´°ã¸</a>
      </div>
    {% endfor %}
  </div>
</div>

{% endblock %}
